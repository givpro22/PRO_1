<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>간단한 지도 표시하기</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=4g9jmh77mh&language=en"></script>
    <style>
        /* 지도 화면을 전체 화면으로 설정 */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
        }

        /* 입력창과 스크롤 가능한 마커 목록 */
        .input-container {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 10;
        }
        #marker-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        /* 정보 창 스타일 */
        .info-window {
            width: 200px;
            text-align: center;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            font-family: Arial, sans-serif;
        }
        .info-window img {
            width: 60px;
            height: auto;
            margin-bottom: 10px;
            border-radius: 50%;
        }
        .info-window h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }
        .info-window p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
<div id="map"></div>

<div class="input-container">
    <label>마커 정보 입력:</label>
    <input type="text" id="marker-info" placeholder="예: 전남대학교 정보">
    <button onclick="addMarker()">마커 추가</button>
    <div id="marker-list"></div>
</div>

<script>
    var username = "<%= loggedInUser ? loggedInUser.username : '' %>";
    var mapOptions = {
        center: new naver.maps.LatLng(35.174444, 126.908611),
        zoom: 15,
        logoControl: false,
        mapDataControl: false,
        scaleControl: false,
        zoomControl: false,
        mapTypeControl: false,
        mapTypeId: naver.maps.MapTypeId.NORMAL
    };

    var map = new naver.maps.Map('map', mapOptions);

    // 전남대학교 마커 생성
    var initialMarker = new naver.maps.Marker({
        position: new naver.maps.LatLng(35.174444, 126.908611),
        map: map
    });

    var initialInfoWindow = new naver.maps.InfoWindow({
        content: `
            <div class="info-window">
                <img src="./images/coffee.png" alt="전남대학교 로고">
                <h3>전남대학교</h3>
                <p>광주 캠퍼스</p>
                ${username ? `<p class="username">사용자: ${username}</p>` : ""}
            </div>
        `
    });

    naver.maps.Event.addListener(initialMarker, 'click', function() {
        initialInfoWindow.open(map, initialMarker);
    });

    // 새 마커 추가 및 리스트 업데이트 함수
    function addMarker() {
        var inputInfo = document.getElementById('marker-info').value;
        if (inputInfo.trim() === "") {
            alert("마커에 표시할 정보를 입력해 주세요.");
            return;
        }

        // 새로운 마커 생성
        var newMarker = new naver.maps.Marker({
            position: map.getCenter(),
            map: map
        });

        // 정보 창 생성
        var newInfoWindow = new naver.maps.InfoWindow({
            content: `
                <div class="info-window">
                    <img src="./images/coffee.png" alt="사용자 정의 로고">
                    <p>${inputInfo}</p>
                </div>
            `
        });

        // 마커 클릭 시 정보 창 표시
        naver.maps.Event.addListener(newMarker, 'click', function() {
            newInfoWindow.open(map, newMarker);
        });

        // 마커 정보를 목록에 추가
        var markerList = document.getElementById('marker-list');
        var newListItem = document.createElement('div');
        newListItem.textContent = inputInfo;
        newListItem.style.marginBottom = "5px";
        markerList.appendChild(newListItem);

        // 입력 필드 비우기
        document.getElementById('marker-info').value = "";
    }

    // 사용자의 현재 위치 표시
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var userLocation = new naver.maps.LatLng(position.coords.latitude, position.coords.longitude);
            var userMarker = new naver.maps.Marker({
                position: userLocation,
                map: map,
                icon: {
                    content: '<div style="width:20px;height:20px;background-color:blue;border-radius:50%;border:2px solid white;"></div>',
                    anchor: new naver.maps.Point(10, 10)
                }
            });
            map.setCenter(userLocation);
        }, function(error) {
            console.error("사용자 위치를 가져올 수 없습니다.", error);
        });
    } else {
        alert("위치 정보를 사용할 수 없습니다.");
    }
</script>
</body>
</html>
